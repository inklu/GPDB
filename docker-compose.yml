version: '3'

services:
#Master host
  mdw:
    hostname: mdw
#    build: ./
#      dockerfile: Dockerfile_PXF
#    image: trueknight/gpdb
    image: trueknight/gpdb:pxf
    restart: unless-stopped
    ports:
      - 5433:5432
    volumes:
      - ./staging:/home/gpadmin/staging
      - ./hostfiles:/home/gpadmin/hostfiles
      - mdw:/data
    environment:
      GPDB_HOST_TYPE: master
      GPDB_PXF_ENABLED: true
      PXF_PORT: 5998
#Segment1 host
  sdw1:
    hostname: sdw1
#    build: ./
#      dockerfile: Dockerfile_PXF
#    image: trueknight/gpdb
    image: trueknight/gpdb:pxf
    restart: unless-stopped
    volumes:
      - ./staging:/home/gpadmin/staging
      - ./hostfiles:/home/gpadmin/hostfiles
      - sdw1:/data
    environment:
      GPDB_HOST_TYPE: segment
#Segment2 host
  sdw2:
    hostname: sdw2
#    build: ./
#      dockerfile: Dockerfile_PXF
#    image: trueknight/gpdb
    image: trueknight/gpdb:pxf
    restart: unless-stopped
    volumes:
      - ./staging:/home/gpadmin/staging
      - ./hostfiles:/home/gpadmin/hostfiles
      - sdw2:/data
    environment:
      GPDB_HOST_TYPE: segment

volumes:
  mdw:
  sdw1:
  sdw2:
